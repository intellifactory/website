<!DOCTYPE html>
<html lang="en">
  <head>
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-1291321-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-1291321-1');
    </script>
    <title>Serving SPAs</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Consider a very typical scenario: you have a web application that serves an SPA. The SPA itself has several &quot;pages,&quot; each with its own client-side routed URLs (think of Gmail, for instance.) Then people copy some of these URLs from their &quot;session&quot; and send them to others, who in turn expect to find exactly what the sender saw. Except with most SPAs, the server-side knows nothing about the URLs generated on the client and usually throws you back to some initial SPA page. Implementing this properly requires you to share all or a subset of the URLs both on the server and on the client. With WebSharper, this is easy." />
    <meta name="author" content="IntelliFactory" />
    <meta property="og:title" content="Serving SPAs" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://intellifactory.com/user/granicz/20171229-serving-spas" />
    <meta property="og:image" content="https://intellifactory.com/img/category3.jpg" />
    <meta property="og:description" content="Consider a very typical scenario: you have a web application that serves an SPA. The SPA itself has several &quot;pages,&quot; each with its own client-side routed URLs (think of Gmail, for instance.) Then people copy some of these URLs from their &quot;session&quot; and send them to others, who in turn expect to find exactly what the sender saw. Except with most SPAs, the server-side knows nothing about the URLs generated on the client and usually throws you back to some initial SPA page. Implementing this properly requires you to share all or a subset of the URLs both on the server and on the client. With WebSharper, this is easy." />
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="@intellifactory" />
    <meta property="twitter:title" content="Serving SPAs" />
    <meta property="twitter:description" content="Consider a very typical scenario: you have a web application that serves an SPA. The SPA itself has several &quot;pages,&quot; each with its own client-side routed URLs (think of Gmail, for instance.) Then people copy some of these URLs from their &quot;session&quot; and send them to others, who in turn expect to find exactly what the sender saw. Except with most SPAs, the server-side knows nothing about the URLs generated on the client and usually throws you back to some initial SPA page. Implementing this properly requires you to share all or a subset of the URLs both on the server and on the client. With WebSharper, this is easy." />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=DM+Sans:400,500,700&amp;subset=latin" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap" />
    <link rel="stylesheet" href="/css/tailwind/tailwind.css" />
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-tailwind.png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" type="text/javascript" charset="UTF-8"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/fsharp.min.js" type="text/javascript" charset="UTF-8"></script><link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/far.min.css"></link>
<!--[if lte IE 11.0]>
<![endif]-->
<!--[if lte IE 9.0]>
<![endif]-->

    <script src="/js/main.js"></script>
  </head>
  <body class="antialiased bg-body text-body font-body">
    <div>
      <section class="px-4 lg:px-10 bg-gray-800 px-2">
        <nav class="relative flex justify-between items-center py-2"><a class="text-2xl text-white font-bold" href="/"><span>Intelli</span>            <span class="text-blue-500 -ml-1">Factory</span></a>
          <div class="lg:hidden">
            <button class="p-2 navbar-burger">
              <svg class="w-10 h-3" width="39" height="13" viewbox="0 0 39 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="39" height="2" rx="1" fill="#C4C4C4"></rect>
                <rect x="19" y="11" width="20" height="2" rx="1" fill="#C4C4C4"></rect>
              </svg>
            </button>
          </div>
          <div class="hidden lg:block ml-auto mr-1">
            <ul class="flex items-center text-white space-x-10">
              <li class="hoverable"><a class="text-white font-bold text-lg" href="/">Home</a></li>
              <li class="hoverable-mm"><a class="text-white font-bold text-lg">Open Source</a>
                <div class="p-6 mega-menu mb-16 sm:mb-0 shadow-xl bg-blue-700">
                  <div class="container mx-auto w-full flex flex-wrap justify-between mx-2">
                    <ul class="px-4 w-full sm:w-1/2 lg:w-1/4 pb-6 pt-6 lg:pt-3">
                      <div class="flex items-center"><img class="h-8 mb-3 mr-3" src="/images/websharper.png" alt="WebSharper" />
                        <h3 class="font-bold text-xl text-white text-bold mb-2">WebSharper</h3>
                      </div>
                      <p class="text-gray-100 text-sm">Functional, reactive .NET web applications without writing JavaScript.</p>
                      <div class="flex items-center py-3"><a href="https://websharper.com" target="_blank"><img src="/images/category3-small.jpg" /></a></div>
                    </ul>
                    <ul class="px-4 w-full sm:w-1/2 lg:w-1/4 pb-6 pt-6 lg:pt-3">
                      <div class="flex items-center"><img class="h-8 mb-3 mr-3" src="/images/bolero.png" alt="Bolero" />
                        <h3 class="font-bold text-xl text-white text-bold mb-2">Bolero</h3>
                      </div>
                      <p class="text-gray-100 text-sm">Future-proof web applications running on WebAssembly instead of JavaScript.</p>
                      <div class="flex items-center py-3"><a href="https://fsbolero.io" target="_blank"><img src="/images/category6-small.jpg" /></a></div>
                    </ul>
                    <ul class="px-4 w-full sm:w-1/2 lg:w-1/4 pb-6 pt-6 lg:pt-3">
                      <div class="flex items-center"><img class="h-8 mb-3 mr-3 fill-current text-white" src="/images/sitefi.jpg" alt="SiteFi" />
                        <h3 class="font-bold text-xl text-white text-bold mb-2">SiteFi</h3>
                      </div>
                      <p class="text-gray-100 text-sm">.NET static web apps, markdown-based, multi-user blogs and documentation sites.</p>
                      <div class="flex items-center py-3"><a href="https://github.com/granicz/SiteFi" target="_blank"><img src="/images/category4-small.jpg" /></a></div>
                    </ul>
                    <ul class="px-4 w-full sm:w-1/2 lg:w-1/4 pb-6 pt-6 lg:pt-3">
                      <div class="flex items-center"><img class="h-8 mb-3 mr-3" src="/images/if-logo.png" alt="IntelliFactory" />
                        <h3 class="font-bold text-xl text-white text-bold mb-2">IntelliFactory Labs</h3>
                      </div>
                      <p class="text-gray-100 text-sm">Miscellaneous F# tools and other material. Some relics here and there.</p>
                      <div class="flex items-center py-3">
                        <svg class="h-6 pr-3 mr-1 fill-current text-teal-300" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 20 20">
                          <path d="M20 10a10 10 0 1 1-20 0 10 10 0 0 1 20 0zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0zm-8 2H5V8h5V5l5 5-5 5v-3z"></path>
                        </svg><a class="font-bold" href="https://github.com/IntelliFactory" target="_blank">GitHub</a>
                      </div>
                    </ul>
                  </div>
                </div>
              </li>
              <li class="hoverable"><a class="text-white font-bold text-lg" href="/blogs">Blogs</a></li>
              <li class="hoverable"><a class="text-white font-bold text-lg" href="/careers">Careers</a></li>
              <li class="hoverable"><a class="text-white font-bold text-lg" href="/contact">Contact</a></li>
            </ul>
          </div>
        </nav>
        <div class="hidden navbar-menu fixed top-0 left-0 bottom-0 w-5/6 max-w-sm z-50">
          <div class="navbar-backdrop fixed inset-0 bg-gray-800 opacity-80"></div>
          <nav class="relative flex flex-col py-8 h-full w-full bg-white overflow-y-auto">
            <div class="flex items-center mb-16 pr-6"><a class="ml-10 text-2xl text-gray-800 font-bold" href="/"><img class="h-7" src="/images/if-logo-long.png" alt="IntelliFactory" /></a></div>
            <div class="hamburger">
              <ul>
                <li class="mb-1 px-10 table"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="/">Home</a></li>
                <li class="mb-1 px-10 table"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl">Open Source</a>
                  <ul class="inline table">
                    <li class="mb-1 px-10"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="https://websharper.com">WebSharper</a></li>
                    <li class="mb-1 px-10"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="https://fsbolero.io">Bolero</a></li>
                    <li class="mb-1 px-10"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="https://github.com/granicz/SiteFi">SiteFi</a></li>
                    <li class="mb-1 px-10"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="https://github.com/IntelliFactory">IF Labs</a></li>
                  </ul>
                </li>
                <li class="mb-1 px-10 table"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="/blogs">Blogs</a></li>
                <li class="mb-1 px-10 table"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="/careers">Careers</a></li>
                <li class="mb-1 px-10 table"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="/contact">Contact</a></li>
              </ul>
            </div>
            <div class="mt-auto px-10">
              <p class="mt-6 mb-4 text-lg text-center"><span>2004-2021 © IntelliFactory. All rights reserved.</span></p>
            </div>
          </nav>
        </div>
      </section>
      
      <section class="relative py-20 2xl:py-40 overflow-hidden">
        <div class="container px-4 mx-auto">
          <div class="max-w-4xl mx-auto text-center">
            <h2 class="bg-opacity-25 bg-gray-900 mb-14 text-6xl lg:text-7xl font-bold font-heading text-white">Serving SPAs</h2>
          </div><img class="absolute top-0 left-0 w-full h-full object-cover" style="z-index:-10;" src="/img/category3.jpg" alt="" />
        </div>
      </section>
      <section class="relative py-10 overflow-hidden bg-blueGray-100">
        <div class="container px-4 mx-auto">
          <div class="max-w-4xl mx-auto text-center">
            <div class="inline-flex items-center flex-wrap"><a href="/user/granicz"><img class="mr-8 w-20 lg:w-24 h-20 lg:h-24 rounded-full" src="/img/avatar/granicz.png" alt="Adam Granicz" /></a>
              <div class="flex-1 text-left"><a href="/user/granicz">
                  <h4 class="mb-1 text-2xl font-bold">Adam Granicz</h4></a>
                <p>Dec 29, 2017</p>
              </div>
              <div class="text-right ml-20 flex-1 flex-basis-100">
                <p class="mb-1 font-bold text-xl">Reading time:</p>
                <p>19 mins</p>
              </div>
              <div class="text-right ml-20 mt-3 flex-1 flex-basis-100">
                <p class="mb-1 font-bold text-xl">Share via:</p>
                <div><a class="inline-block mr-2" href="https://twitter.com/intent/tweet?text=Serving+SPAs&amp;url=https%3a%2f%2fintellifactory.com%2fuser%2fgranicz%2f20171229-serving-spas">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewbox="0 0 24 24" fill="#00acee">
                      <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path>
                    </svg></a>                  <a class="inline-block mr-2" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fintellifactory.com%2fuser%2fgranicz%2f20171229-serving-spas">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewbox="0 0 24 24" fill="#0e76a8">
                      <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-2 16h-2v-6h2v6zm-1-6.891c-.607 0-1.1-.496-1.1-1.109 0-.612.492-1.109 1.1-1.109s1.1.497 1.1 1.109c0 .613-.493 1.109-1.1 1.109zm8 6.891h-1.998v-2.861c0-1.881-2.002-1.722-2.002 0v2.861h-2v-6h2v1.093c.872-1.616 4-1.736 4 1.548v3.359z"></path>
                    </svg></a>                  <a class="inline-block" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fintellifactory.com%2fuser%2fgranicz%2f20171229-serving-spas">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewbox="0 0 24 24" fill="#3b5998">
                      <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm3 8h-1.35c-.538 0-.65.221-.65.778v1.222h2l-.209 2h-1.791v7h-3v-7h-2v-2h2v-2.308c0-1.769.931-2.692 3.029-2.692h1.971v3z"></path>
                    </svg></a></div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="py-20 bg-white overflow-hidden">
        <div class="container px-4 mx-auto">
          <div class="max-w-4xl mx-auto markdown"><div ws-preserve=""><p>(This article is part of <a href="https://sergeytihon.com/2017/10/22/f-advent-calendar-in-english-2017/">F# Advent 2017</a> - thanks to <a href="https://sergeytihon.com/">Sergey Tihon</a> for organizing!)</p>
<p>Consider a very typical scenario: you have a web application that serves an SPA. The SPA itself has several &quot;pages,&quot; each with its own client-side routed URLs (think of Gmail, for instance.) Then people copy some of these URLs from their &quot;session&quot; and send them to others, who in turn expect to find exactly what the sender saw. Except with most SPAs, the server-side knows nothing about the URLs generated on the client and usually throws you back to some initial SPA page. Implementing this properly requires you to share all or a subset of the URLs both on the server and on the client. With WebSharper, this is easy.</p>
<h3 id="routing">Routing</h3>
<p>One fundamental difference between WebSharper and other server-side capable F# frameworks such as Giraffe or Suave, is that WebSharper supports <strong>safe URLs</strong>, i.e. URLs computed from the serving context (as opposed to encoding them as ordinary strings) that are guaranteed to be correct.</p>
<p>Consider the following simple app in Giraffe:</p>
<pre><code class="language-fsharp">open Giraffe

let webApp =
    choose [
        route &quot;/ping&quot;     &gt;=&gt; text &quot;pong&quot;
        routef &quot;/echo/%s&quot; (fun s -&gt; text s)
        route &quot;/&quot;         &gt;=&gt; htmlFile &quot;/pages/index.html&quot; ]

type Startup() =
    member __.Configure (app : IApplicationBuilder)
                        (env : IHostingEnvironment)
                        (loggerFactory : ILoggerFactory) =

        app.UseGiraffe webApp
</code></pre>
<p>The same app would look like this in WebSharper:</p>
<pre><code class="language-fsharp">open WebSharper
open WebSharper.Sitelets

type EndPoint =
    | [&lt;EndPoint &quot;/&quot;&gt;]     Home
    | [&lt;EndPoint &quot;/ping&quot;&gt;] Ping
    | [&lt;EndPoint &quot;/echo&quot;&gt;] Echo of string

[&lt;Website&gt;]
let Main =
    Application.MultiPage (fun (ctx: Context&lt;EndPoint&gt;) -&gt; function
        | EndPoint.Home   -&gt; Content.File &quot;pages/index.html&quot;
        | EndPoint.Ping   -&gt; Content.Text &quot;pong&quot;
        | EndPoint.Echo s -&gt; Content.Text s
    )
</code></pre>
<p>With this declaration, <strong>you can obtain the correct URL to any page</strong> (or &quot;endpoint&quot;, and fully formed with any of its page arguments) from the serving context, which itself is parameterized over the (typically) discriminated union type that represents all entry points to the application.</p>
<p>For instance, you can get the URL to a particular instantiation of the &quot;echo&quot; page as follows:</p>
<pre><code class="language-fsharp">   ctx.Link (EndPoint.Echo &quot;hello&quot;)
</code></pre>
<p>Now, clearly, there is a lot you would/could want to do with URLs/endpoints. Making them accessible via POST instead of GET, adding authentication, passing or posting structured values, etc. (You can find the relevant <a href="https://developers.websharper.com/docs/v4.1/fs/sitelets">WebSharper documentation here</a>.) You can do all of these in WebSharper and Giraffe, equally. The main difference, however, remains that Giraffe (or Suave for that matter) builds these up from smaller functions/combinators, whereas WebSharper enables you to do these declaratively (attached to the type that represents your endpoints, i.e. <code>EndPoint</code> above) and generates a similar pipeline of combinators under the cover (you can also construct routers manually, similar to Giraffe). This gains not only safe URLs, but also a number of other benefits.</p>
<p>One such benefit is exactly what we need: sharing the URL space between the server and the client side. In pure SPAs, this means sharing the full endpoint type, but more often than that you would want your client-side URL space as a proper subset of the full endpoint set.</p>
<h3 id="a-barebones-approach">A barebones approach</h3>
<p><a href="https://i.imgur.com/Dk73D2j.png"><img src="https://i.imgur.com/Dk73D2jm.png" alt="" /></a>
<a href="https://i.imgur.com/K2PnK5I.png"><img src="https://i.imgur.com/K2PnK5Im.png" alt="" /></a>
<a href="https://i.imgur.com/XYPtC8R.png"><img src="https://i.imgur.com/XYPtC8Rm.png" alt="" /></a></p>
<p>(In the screeshots above, the city pages are routed on the client and no server roundtrip (and thus no page refresh) is taking place. The home page is re-requested from the server every time you visit it, you can add other server-based pages easily. However, you can refresh each page, including the two kinds of SPA pages, and you will correctly see the same content.)</p>
<p>Say you want an app (shown above, grab it via a gist <a href="https://gist.github.com/granicz/eeaf2140a3f1fbccc9ebb4af9deadaa1">here</a>) to report things on various cities using the following URLs:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">URL</th>
<th style="text-align: left;">.....</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>/</code></td>
<td style="text-align: left;">The root/home page</td>
</tr>
<tr>
<td style="text-align: left;"><code>/spa/cities</code></td>
<td style="text-align: left;">The page listing our cities, the main SPA</td>
</tr>
<tr>
<td style="text-align: left;"><code>/spa/cities/XYZ</code></td>
<td style="text-align: left;">A page for showing info for a given city</td>
</tr>
</tbody>
</table>
<p>You can define your endpoint type as follows:</p>
<pre><code class="language-fsharp">type SPA =
    | [&lt;EndPoint &quot;/cities&quot;&gt;] Cities
    | [&lt;EndPoint &quot;/cities&quot;&gt;] City of string

type EndPoint =
    | [&lt;EndPoint &quot;/&quot;&gt;] Home
    | [&lt;EndPoint &quot;/spa&quot;&gt;] SPA of SPA
</code></pre>
<p>The intention is that <strong><code>/spa/*</code> URLs will be routed and their content generated on the client</strong> (i.e. without a server roundtrip). You can do this easily by combining <code>Router.Infer&lt;...&gt;</code> (to create a router for an endpoint type automatically), <code>Router.Slice</code> (to split the part of it you want to make available on the client), and <code>Router.Install</code> (to create a client-side router to listen to URL changes in the browser) - alternatively, you can also use <code>Router.InstallHash</code> for a hash-based version:</p>
<pre><code class="language-fsharp">    let router = Router.Infer&lt;EndPoint&gt;()
    let location =
        router
        |&gt; Router.Slice (function | SPA spa -&gt; Some spa | _ -&gt; None) EndPoint.SPA
        |&gt; Router.Install SPA.Cities
</code></pre>
<p>The type of <code>location</code> is <code>Var&lt;SPA&gt;</code>, a reactive variable that you can observe the value of (to fetch the current SPA page) or set directly (to route to that page). Note the sharp contrast between this type-safe approach and other ad-hoc methods that perform these via ordinary strings.</p>
<pre><code class="language-fsharp">open WebSharper.UI.Notation

location := SPA.Cities
</code></pre>
<p>You can now reactively construct the individual SPA pages based on the value of <code>location</code> and a simple city store:</p>
<pre><code class="language-fsharp">[&lt;JavaScript&gt;]
module Client =
    open WebSharper.UI.Client
    
    let store =
        [
            &quot;Budapest&quot;, &quot;awesome&quot;
            &quot;Paris&quot;, &quot;famous&quot;
            &quot;San Francisco&quot;, &quot;expensive&quot;
            &quot;London&quot;, &quot;cosmopolitan&quot;
            &quot;Singapore&quot;, &quot;crowded&quot;
        ]
        
    let Main () =
        ...
        location.View.Doc(function
            | SPA.Cities -&gt;
                Doc.Concat [
                    ul [] (
                        store |&gt; List.map (fun (city, _) -&gt;
                            a [attr.href &lt;| router.Link (EndPoint.SPA (SPA.City city))] [
                                li [] [text city]
                            ] :&gt; Doc)
                    )
                ]
            | SPA.City city -&gt;
                let message =
                    match List.tryFind (fun (cty, _) -&gt; city=cty) store with
                    | None -&gt;
                        p [] [text &quot;I don't know your city :(&quot;]
                    | Some (_, adjective) -&gt;
                        p [] [text &lt;| &quot;Your city is &quot; + adjective + &quot;!&quot;]
                Doc.Concat [
                    h1 [] [text city]
                    message
                    p [] [
                        text &quot;Click &quot;
                        a [attr.href (router.Link (EndPoint.SPA SPA.Cities))] [text &quot;here&quot;]
                        text &quot; to go back.&quot;
                    ]
                ]
        )
</code></pre>
<p>All that remains is serving this SPA and an empty home page from the server-side:</p>
<pre><code class="language-fsharp">module Site =
    let HomePage (ctx: Context&lt;EndPoint&gt;) =
        Content.Page(
            Title = &quot;Home&quot;,
            Body = [
                p [] [
                    text &quot;There is nothing here, go to the &quot;
                    a [attr.href &lt;| ctx.Link (EndPoint.SPA SPA.Cities)] [text &quot;Cities page&quot;]
                ]
            ]
        )

    let CitiesPage ctx =
        Content.Page(
            Title = &quot;Cities&quot;,
            Body = [
                div [] [client &lt;@ Client.Main () @&gt; ]
            ]

        )

    [&lt;Website&gt;]
    let Main =
        Application.MultiPage (fun ctx endpoint -&gt;
            match endpoint with
            | EndPoint.Home -&gt;
                HomePage ctx
            | EndPoint.SPA SPA.Cities
            | EndPoint.SPA (SPA.City _) -&gt;
                CitiesPage ctx
        )
</code></pre>
<p>This app, which can be hosted in any ASP.NET- or OWIN-compatible container, including Suave, or self-hosted) guarantees that we can serve any one of the three types of URLs we specified earlier, and it correctly routes the SPA (<code>/spa/*</code>) accordingly as well. (Note: you can also accomplish this also by combining Suave or Giraffe for the server-side and Fable.Elmish on the client-side, but <strong>you won't get any integration or safe URL representation between the two tiers</strong>.)</p>
<h3 id="adding-templating">Adding templating</h3>
<p><a href="https://i.imgur.com/uBAdweU.png"><img src="https://i.imgur.com/uBAdweUm.png" alt="" /></a>
<a href="https://i.imgur.com/mOuYbuL.png"><img src="https://i.imgur.com/mOuYbuLm.png" alt="" /></a>
<a href="https://i.imgur.com/eKE3u0D.png"><img src="https://i.imgur.com/eKE3u0Dm.png" alt="" /></a></p>
<p>Another very common need is <strong>to be able to modify an application, or at least its appearance, at runtime</strong>. For instance, you may want to touch up some of the markup you generate in your application, change its structure, add new attributes here and there, etc. On the server-side, both Suave and Giraffe provide a way to serve templated content via DotLiquid. They can also detect modifications to these templates and reload them before serving new content based on them. However, support for templating on the client-side from an F# perspective is severely limited, and you typically fall back to using Mustache, Handlebars, Underscore, or whatever JavaScript-based templating engine you prefer, via inlined JS code, or no support at all.</p>
<p>Not with WebSharper. Although you can easily adapt DotLiquid and other server-side templating engines to plug directly into WebSharper content, WebSharper UI also comes with its own templating engine that you can read about <a href="https://developers.websharper.com/docs/v4.1/fs/ui">here</a>. The nice thing about this templating engine is that <strong>it works both on the server and on the client, unlike anything else</strong>.</p>
<p>What we want is to remove as much of the inlined HTML from our F# code as possible and replace it with HTML templates that we can then modify external to the application. And don't even think about trying to push CSS and other silliness into your F# code, as it will limit you severely. For this example, I cooked up a straightforward template (<code>Main.html</code>) that uses Bulma, which you can find in <a href="https://gist.github.com/granicz/9cd31128496fda6c0f6c228cce55d246">this gist</a>.</p>
<p>For instance, consider the following fragment, which defines a <code>Banner</code> placeholder and two inner &quot;sub&quot; templates <code>HomeBanner</code> and <code>CitiesBanner</code>, that can be readily plugged into <code>Banner</code>.</p>
<pre><code class="language-xml">  &lt;div ws-replace=&quot;Banner&quot;&gt;
    &lt;section class=&quot;hero is-info&quot; ws-template=&quot;HomeBanner&quot;&gt;
      &lt;div class=&quot;hero-body&quot;&gt;
        &lt;p class=&quot;title&quot;&gt;Home&lt;/p&gt;
      &lt;/div&gt;
    &lt;/section&gt;
    &lt;section class=&quot;hero is-info&quot; ws-template=&quot;CitiesBanner&quot;&gt;
      &lt;div class=&quot;hero-body&quot;&gt;
        &lt;p class=&quot;title&quot;&gt;Cities&lt;/p&gt;
        &lt;p class=&quot;subtitle&quot;&gt;Pick your favorite city.&lt;/p&gt;
      &lt;/div&gt;
    &lt;/section&gt;
  &lt;/div&gt;
</code></pre>
<p>Or consider the nested templates for the SPA content:</p>
<pre><code class="language-xml">      &lt;div class=&quot;content&quot;&gt;
        &lt;div ws-replace=&quot;Body&quot;&gt;
          &lt;ul ws-template=&quot;CityLinks&quot; ws-hole=&quot;Links&quot;&gt;
            &lt;li ws-template=&quot;CityLink&quot;&gt;&lt;a href=&quot;${Link}&quot;&gt;${Title}&lt;/a&gt;&lt;/li&gt;
          &lt;/ul&gt;
          &lt;div ws-template=&quot;CityPage&quot;&gt;
            &lt;h1&gt;${Name}&lt;/h1&gt;
            &lt;div ws-replace=&quot;Message&quot;&gt;
              &lt;div ws-template=&quot;NotFound&quot;&gt;
                &lt;p&gt;I don't know your city :(&lt;/p&gt;
              &lt;/div&gt;
              &lt;div ws-template=&quot;Found&quot;&gt;
                &lt;p&gt;Your city is &lt;b&gt;${Kind}&lt;/b&gt;&lt;/p&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            &lt;p&gt;Click &lt;a href=&quot;${BackLink}&quot;&gt;here&lt;/a&gt; to return.&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
</code></pre>
<p>All you have to do now is to bring the template and all the good stuff in it into scope:</p>
<pre><code class="language-fsharp">    open WebSharper.UI.Templating

    type MainTemplate = Template&lt;&quot;Main.html&quot;, ClientLoad.FromDocument, ServerLoad.WhenChanged&gt;
</code></pre>
<p>This says &quot;go through <code>Main.html</code> and find all placeholders, templates and nested templates in it, and make them available under <code>MainTemplate</code>, and if the file changes refresh it automatically when used from the server, and reload it automatically from the main document on the client (since we are in an SPA that is based on the very same file.)&quot; <strong>This one line performs a LOT if you think about it, and all that complexity is taken care of and hidden from you, so you can concentrate on your code and logic instead</strong>.</p>
<p>Contrast what happens inside <code>Client.Main()</code> now with templating:</p>
<pre><code class="language-fsharp">[&lt;JavaScript&gt;]
module Client =
    ...
    let Main () =
        ...
        location.View.Doc(function
            | SPA.Cities -&gt;
                MainTemplate.CityLinks()
                    .Links(
                        store |&gt; List.map (fun (city, _) -&gt;
                            MainTemplate.CityLink()
                                .Link(router.Link (EndPoint.SPA (SPA.City city)))
                                .Title(city)
                                .Doc()
                        )
                    )
                    .Doc()
            | SPA.City city -&gt;
                let message =
                    match List.tryFind (fst &gt;&gt; (=) city) store with
                    | None -&gt;
                        MainTemplate.NotFound().Doc()
                    | Some (_, adjective) -&gt;
                        MainTemplate.Found().Kind(adjective).Doc()
                MainTemplate.CityPage()
                    .Name(city)
                    .Message(message)
                    .BackLink(router.Link (EndPoint.SPA SPA.Cities))
                    .Doc()
        )
</code></pre>
<p>Not a single in-code HTML combinator in sight - so we are good to go. The final F# code is 110 LOC, and it serves our SPA and all of its links when visited directly as well, all dressed up in a nice Bulma-based master template. Hurray!</p>
<h3 id="summing-up">Summing up</h3>
<p>In this article, we looked at two fundamental problems you are likely to encounter in any serious web development: serving SPAs with their URLs understood both on the server and the client, and externalizing your entire presentation layer so it can be modified at runtime.</p>
<p>If you want to try the gists, start with a Client-Server Application template after installing WebSharper into your Visual Studio (you can grab the VSIX installer from the <a href="https://websharper.com">main website</a>, or download that template from the developer site (from the Apps menu on the top.)</p>
<p>Guess what? You can do all this in C# as well, but I'll save that for another article! So stay tuned and don't hesitate to ask about WebSharper on the <a href="https://forums.websharper.com">forums</a>, and be sure to check out the <a href="https://developers.websharper.com">documentation</a> - both 100% WebSharper SPAs in case you wondered 😉</p>
<h4 id="forums">Forums</h4>
<p><a href="https://forums.websharper.com"><img src="https://i.imgur.com/2DkBX2ol.png" alt="" /></a></p>
<h4 id="documentation">Documentation</h4>
<p><a href="https://developers.websharper.com"><img src="https://i.imgur.com/ANg1Fual.png" alt="" /></a></p>
<h4 id="quick-links">Quick links:</h4>
<ul>
<li>documentation on <a href="http://developers.websharper.com/docs/v4.1/fs/sitelets">routing requests</a></li>
<li>documentation on <a href="http://developers.websharper.com/docs/v4.1/fs/ui">WebSharper UI and templating</a></li>
<li>barebones example in <a href="https://gist.github.com/granicz/eeaf2140a3f1fbccc9ebb4af9deadaa1">this gist</a>, and</li>
<li>the templated version in <a href="https://gist.github.com/granicz/9cd31128496fda6c0f6c228cce55d246">this gist</a></li>
</ul>
<p>Happy holidays and happy coding!</p>
</div></div>
        </div>
      </section>
      <section class="py-20 bg-white">
        <div class="container px-4 mx-auto">
          <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center mb-12">
            <div class="lg:w-2/3 lg:pr-16 mb-2 lg:mb-8">
              <h2 class="text-3xl md:text-4xl font-bold font-heading">Read more from </h2>
            </div>
            <div class="text-sm lg:text-base lg:w-1/3">
              <p class="leading-loose text-blueGray-500"><span>Can’t find what you were looking for? </span>                <a class="text-blue-600 hover:text-blue-700" href="/contact">Drop us a line</a>.
                              
              </p>
            </div>
          </div>
          <div class="flex flex-wrap -mx-4">
            <div class="w-full md:w-1/2 lg:w-1/4 px-4 mb-8"><a href="/user/granicz">
                <div class="inline-flex items-center"><img class="mr-2 w-4 h-4 lg:w-8 lg:h-8 rounded-full" src="/img/avatar/granicz.png" alt="Adam Granicz" />
                  <div class="flex-1 text-left"><span class="text-lg font-bold text-blueGray-400">Adam Granicz</span></div>
                </div></a>              <a href="/user/granicz/20241222-intellilogo">
                <h4 class="text-xl font-semibold">IntelliLogo</h4></a>
              <p class="text-sm md:text-base text-blueGray-400">20241222 · 26 min read</p>
            </div><div class="w-full md:w-1/2 lg:w-1/4 px-4 mb-8"><a href="/user/granicz">
                <div class="inline-flex items-center"><img class="mr-2 w-4 h-4 lg:w-8 lg:h-8 rounded-full" src="/img/avatar/granicz.png" alt="Adam Granicz" />
                  <div class="flex-1 text-left"><span class="text-lg font-bold text-blueGray-400">Adam Granicz</span></div>
                </div></a>              <a href="/user/granicz/20240102-A-new-fullstack-SPA-template-for-WebSharper-and-whats-next">
                <h4 class="text-xl font-semibold">A new fullstack SPA template for WebSharper and what&#39;s next</h4></a>
              <p class="text-sm md:text-base text-blueGray-400">20240102 · 11 min read</p>
            </div><div class="w-full md:w-1/2 lg:w-1/4 px-4 mb-8"><a href="/user/granicz">
                <div class="inline-flex items-center"><img class="mr-2 w-4 h-4 lg:w-8 lg:h-8 rounded-full" src="/img/avatar/granicz.png" alt="Adam Granicz" />
                  <div class="flex-1 text-left"><span class="text-lg font-bold text-blueGray-400">Adam Granicz</span></div>
                </div></a>              <a href="/user/granicz/20221229-full-stack-fsharp-with-charting-reactive-forms-and-more-under-300-loc-with-websharper">
                <h4 class="text-xl font-semibold">Full-stack F# with charting, reactive forms, and more under 300 LOC with WebSharper</h4></a>
              <p class="text-sm md:text-base text-blueGray-400">20221229 · 30 min read</p>
            </div><div class="w-full md:w-1/2 lg:w-1/4 p-4 mb-8 bg-gray-50 rounded-3xl"><a href="https://github.com/IntelliFactory/blogs/tree/master/user/granicz/20171229-serving-spas.md">
                <div class="inline-flex items-center"><img class="mr-2 w-4 h-4 lg:w-8 lg:h-8 rounded-full" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="Adam Granicz" />
                  <div class="flex-1 text-left"><span class="text-lg font-bold text-blueGray-400">Found a typo?</span></div>
                </div></a>
              <h4 class="text-xl font-semibold">This blog post is hosted on GitHub <a href="https://github.com/IntelliFactory/blogs/tree/master/user/granicz/20171229-serving-spas.md">here</a>. Feel free to file a ticket or send a PR.</h4>
            </div>
            
            
          </div>
        </div>
      </section>
      
      
      <section class="2xl:pt-16 xl:pb-8 py-5 bg-blueGray-50">
        <div class="container mx-auto px-4">
          <div class="flex flex-wrap border-b border-gray-100 pt-5 lg:pt-10">
            <div class="w-full lg:w-3/5 px-4">
              <div class="flex flex-wrap px-5 pb-4">
                <div class="w-1/2 lg:w-1/3 mb-12">
                  <h3 class="mb-8 lg:mb-10 text-xl font-bold font-heading">IntelliFactory</h3>
                  <ul class="text-lg">
                    <li class="mb-4"><a class="hover:underline" href="/blogs">Blogs</a></li>
                    <li class="mb-4"><a class="hover:underline" href="/careers">Careers</a></li>
                    <li><a href="/contact">Contact</a></li>
                  </ul>
                </div>
                <div class="w-full lg:w-1/3 px-4 mb-4">
                  <h3 class="mb-8 lg:mb-10 text-xl font-bold font-heading">Services</h3>
                  <ul class="text-lg">
                    <li class="mb-4"><a class="hover:underline" href="/home#consulting">Consulting</a></li>
                    <li class="mb-4"><a class="hover:underline" href="/home#trainings">Trainings</a></li>
                    <li class="mb-4"><a class="hover:underline" href="/home#code-synthesis">AI-driven Code Synthesis</a></li>
                    <li class="mb-4"><a class="hover:underline" href="/home#dsls">Domain-Specific Languages</a></li>
                  </ul>
                </div>
                <div class="w-1/2 lg:w-1/3 px-4 mb-12">
                  <h3 class="mb-8 lg:mb-10 text-xl font-bold font-heading">Open Source</h3>
                  <ul class="text-lg">
                    <li class="mb-4"><a class="hover:underline" href="https://websharper.com">WebSharper</a></li>
                    <li class="mb-4"><a class="hover:underline" href="https://fsbolero.io">Bolero</a></li>
                    <li class="mb-4"><a class="hover:underline" href="#">From our Lab</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="w-full lg:w-2/5 px-4 order-first lg:order-last mb-16 lg:mb-0">
              <h3 class="mb-10 text-xl font-bold">Newsletter</h3>
              <form method="post" id="newsletter-form">
                <div class="md:max-w-sm mb-8 flex items-center bg-white border border-gray-100 rounded-full"><span class="inline-block pl-2 lg:pl-5">
                    <svg width="37" height="37" viewbox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="18.5" cy="18.5" r="9.5" fill="#1F40FF" fill-opacity="0.15"></circle>
                      <circle cx="18.5" cy="18.5" r="18.5" fill="#1F40FF" fill-opacity="0.06"></circle>
                      <circle cx="18.5" cy="18.5" r="2.5" fill="#282C36"></circle>
                    </svg></span>
                  <input id="newsletter-input" class="pl-4 py-2 focus:outline-none rounded-full placeholder-gray-900 font-bold" type="email" placeholder="Your email address" />
                  <button id="signup" class="ml-auto px-6 lg:px-8 py-4 text-white font-bold bg-blue-500 hover:bg-blue-600 rounded-full transition duration-200">Ok</button>
                </div>
                <div id="newsletter-alert-list"></div>
                <p class="text-gray-300">We will not spam you or give your details to anyone.</p>
              </form>
            </div>
          </div>
          <div class="flex flex-wrap items-center mb-8 lg:mb-0 pt-5">
            <div class="hidden md:block w-full md:w-3/4 mb-8 md:mb-0">
              <div class="md:flex items-center"><a class="inline-block text-gray-900 text-xl font-bold" href="#"><img class="h-7" src="/images/if-logo-long.png" alt="IntelliFactory" width="auto" /></a>              <span class="hidden md:inline-block mx-8 w-px h-8 bg-gray-50"></span>
                <p class="hidden lg:block text-sm text-gray-300"><span class="text-gray-700">Copyright © 2004-2021 IntelliFactory.</span>                All rights reserved. Made with
                                  <img width="16" height="20" style="display:inline;vertical-align:middle;" alt="Love" src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Love_Heart_SVG.svg/32px-Love_Heart_SVG.svg.png" />                in 100% F#.
                                
                </p>
              </div>
            </div>
            <div class="w-full md:w-1/4">
              <div class="md:flex items-center justify-end"><a class="inline-block mr-2" href="https://github.com/intellifactory">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewbox="0 0 24 24">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path>
                  </svg></a>              <a class="inline-block mr-2" href="https://facebook.com/intellifactory">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewbox="0 0 24 24" fill="#3b5998">
                    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm3 8h-1.35c-.538 0-.65.221-.65.778v1.222h2l-.209 2h-1.791v7h-3v-7h-2v-2h2v-2.308c0-1.769.931-2.692 3.029-2.692h1.971v3z"></path>
                  </svg></a>              <a class="inline-block mr-2" href="https://twitter.com/intellifactory">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewbox="0 0 24 24" fill="#00acee">
                    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"></path>
                  </svg></a>              <a class="inline-block mr-2" href="https://www.linkedin.com/company/intellifactory">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewbox="0 0 24 24" fill="#0e76a8">
                    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-2 16h-2v-6h2v6zm-1-6.891c-.607 0-1.1-.496-1.1-1.109 0-.612.492-1.109 1.1-1.109s1.1.497 1.1 1.109c0 .613-.493 1.109-1.1 1.109zm8 6.891h-1.998v-2.861c0-1.881-2.002-1.722-2.002 0v2.861h-2v-6h2v1.093c.872-1.616 4-1.736 4 1.548v3.359z"></path>
                  </svg></a>              <a class="inline-block" href="https://vimeo.com/user15828007">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewbox="0 0 24 24" fill="#86c9ef">
                    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.82 11.419c-1.306 2.792-4.463 6.595-6.458 6.595-1.966 0-2.25-4.192-3.324-6.983-.527-1.372-.868-1.058-1.858-.364l-.604-.779c1.444-1.27 2.889-2.745 3.778-2.826.998-.096 1.615.587 1.845 2.051.305 1.924.729 4.91 1.472 4.91.577 0 2.003-2.369 2.076-3.215.13-1.24-.912-1.277-1.815-.89 1.43-4.689 7.383-3.825 4.888 1.501z"></path>
                  </svg></a></div>
            </div>
          </div>
        </div>
      </section>
      
      <div>
        
        <meta id='websharper-data' name='websharper-data' content='{"$TYPES":[],"$DATA":{"$V":{}}}' />
<script src="../../Scripts/WebSharper.Core.JavaScript/Runtime.js" type="text/javascript" charset="UTF-8"></script><script type="text/javascript">
if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '../../Scripts/';
  IntelliFactory.Runtime.Start();
}
</script>

        <script src="/js/Dynamic.js"></script>
      </div>
    </div>
  </body>
</html>