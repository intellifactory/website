<!DOCTYPE html>
<html lang="en">
<head>
    <title>Page title</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&amp;display=swap" />
    <link rel="stylesheet" href="/css/tailwind/tailwind.min.css" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-tailwind.png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js" type="text/javascript" charset="UTF-8"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/fsharp.min.js" type="text/javascript" charset="UTF-8"></script><link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/vs.min.css"></link>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" type="text/javascript" charset="UTF-8"></script>
    <script src="/js/main.js"></script>
</head>
<body class="antialiased bg-body text-body font-body">
    <div class="">
        <section class="py-8 px-4 lg:px-10 bg-gray-800">
            <nav class="relative flex justify-between items-center">
                <a class="text-2xl text-white font-bold" href="#">
                    <img class="h-7" src="/files/logos/zospace-logo.svg" alt="" width="auto" />
                </a>
                <div class="lg:hidden">
                    <button class="p-2 navbar-burger">
                        <svg class="w-10 h-3" width="39" height="13" viewbox="0 0 39 13" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="39" height="2" rx="1" fill="#C4C4C4"></rect><rect x="19" y="11" width="20" height="2" rx="1" fill="#C4C4C4"></rect></svg>
                    </button>
                </div>
                <div class="hidden lg:block absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-1/2">
                    <ul class="flex items-center text-white space-x-10">
                        <li><a class="text-white font-bold text-lg" href="#">Home</a></li>
                        <span>
                            <svg width="5" height="5" viewbox="0 0 5 5" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="2.5" cy="2.5" r="2.5" fill="#726B6B"></circle></svg>
                        </span>
                        <li><a class="text-white font-bold text-lg" href="#">Open Source</a></li>
                        <span>
                            <svg width="5" height="5" viewbox="0 0 5 5" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="2.5" cy="2.5" r="2.5" fill="#726B6B"></circle></svg>
                        </span>
                        <li><a class="text-white font-bold text-lg" href="#">Blog</a></li>
                        <span>
                            <svg width="5" height="5" viewbox="0 0 5 5" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="2.5" cy="2.5" r="2.5" fill="#726B6B"></circle></svg>
                        </span>
                        <li><a class="text-white font-bold text-lg" href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="hidden lg:block"><a class="inline-block px-12 py-4 text-white font-bold border border-gray-200 hover:border-white rounded-full" href="#">Sign Up</a></div>
            </nav>
            <div class="hidden navbar-menu fixed top-0 left-0 bottom-0 w-5/6 max-w-sm z-50">
                <div class="navbar-backdrop fixed inset-0 bg-gray-800 opacity-80"></div>
                <nav class="relative flex flex-col py-8 h-full w-full bg-white overflow-y-auto">
                    <div class="flex items-center mb-16 pr-6">
                        <a class="ml-10 text-2xl text-gray-800 font-bold" href="#">
                            <img class="h-7" src="/files/logos/zospace-dark-logo.svg" alt="" width="auto" />
                        </a>
                    </div>
                    <div>
                        <ul>
                            <li class="mb-1 px-10"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="#">Home</a></li>
                            <li class="mb-1 px-10"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="#">Open Source</a></li>
                            <li class="mb-1 px-10"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="#">Blog</a></li>
                            <li class="mb-1 px-10"><a class="block pl-8 py-4 text-xl text-gray-800 hover:bg-blueGray-50 rounded-xl" href="#">Contact</a></li>
                        </ul>
                    </div>
                    <div class="mt-auto px-10">
                        <div class="pt-6"><a class="block mb-4 py-4 px-12 text-gray-800 text-center font-bold border border-gray-50 hover:border-gray-100 rounded-full" href="#">Sign in</a><a class="block py-4 px-12 text-white text-center font-bold bg-blue-500 hover:bg-blue-600 rounded-full transition duration-200" href="#">Sign up</a></div>
                        <p class="mt-6 mb-4 text-lg text-center">
                            <span>2021 © Zospace. All rights reserved.</span>
                        </p>
                    </div>
                </nav>
            </div>
        </section>
        

        <section class="py-20 2xl:py-40 bg-blue-800 overflow-hidden">
            <div class="container px-4 mx-auto">
                <div class="max-w-3xl mx-auto text-center">
                    <h2 class="mb-14 text-6xl lg:text-7xl font-bold font-heading text-white">Password-less authentication with WebSharper.OAuth</h2>
                    <div class="inline-flex mb-14 lg:mb-20 items-center">
                        <img class="mr-8 w-20 lg:w-24 h-20 lg:h-24 rounded-full" src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;amp;ixlib=rb-1.2.1&amp;amp;auto=format&amp;amp;fit=crop&amp;amp;w=800&amp;amp;q=80" alt="" />
                        <div class="text-left">
                            <h4 class="mb-1 text-2xl font-bold text-gray-50">Loic Denuziere</h4>
                            <p class="text-white">Jan 09, 2018</p>
                        </div>
                    </div>
                </div>
                <div class="relative h-96 mb-20">
                    <img class="w-full h-full object-cover" src="https://images.unsplash.com/photo-1517171771326-cbc7f641008a?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;amp;ixlib=rb-1.2.1&amp;amp;auto=format&amp;amp;fit=crop&amp;amp;w=1200&amp;amp;q=80" alt="" />
                    <img class="absolute bottom-0 left-0 ml-4 lg:ml-12 -mb-16 lg:-mb-24 w-32 lg:w-48 h-40 lg:h-60 object-cover" src="https://images.unsplash.com/photo-1618938700817-fe48bd93f20b?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;amp;ixlib=rb-1.2.1&amp;amp;auto=format&amp;amp;fit=crop&amp;amp;w=800&amp;amp;q=80" alt="" />
                </div>
                <div class="max-w-4xl mx-auto markdown"><div ws-preserve=""><p>It used to be that authenticating users in a properly secure way was a big hassle; but with protocols like OAuth and OpenID, things are now much simpler. We can delegate most of the trouble to services such as Facebook, Google, Twitter, Github, etc and simply interface with them.</p>
<p>Today I will show how to use WebSharper.OAuth to authenticate with an OAuth2 provider and and query this provider's API. I will use Github, but any OAuth2 provider will work similarly.</p>
<p>Let's start by creating a simple client-server website application. In Visual Studio, select &quot;WebSharper 4 Client-Server Application&quot;. Then, add the <code>WebSharper.OAuth</code> NuGet package to the project. Once this is done, we are ready to code.</p>
<p>This application consists of two pages, Home and About. We will make the About page only accessible to authenticated users; unauthorized users will see a link to log in with Github instead.</p>
<p>The OAuth2 authorization works as follows:</p>
<ul>
<li>The user clicks a link from your site to the service provider (in our case, Github).</li>
<li>The service provider's website prompts the user to accept or refuse to give your website access to their data.</li>
<li>They are redirected back to a special page of your website, called the <em>redirect endpoint</em>, where you can examine their answer.</li>
<li>If they accepted, this answer includes an <em>authentication token</em> which you can use to request the service provider's API for user data. In this example, we will simply request their Github username.</li>
</ul>
<p>There are some additional requests and checks between your website and the service provider, but you don't need to worry about these; they are handled by WebSharper.OAuth.</p>
<p>First, we need to add the redirect endpoint to our endpoint type; let's set its URL to <code>/oauth-github</code>.</p>
<pre><code>type EndPoint =
    | [&lt;EndPoint &quot;/&quot;&gt;] Home
    | [&lt;EndPoint &quot;/about&quot;&gt;] About
    | [&lt;EndPoint &quot;/oauth-github&quot;&gt;] OAuthGitHub
</code></pre>
<p>In WebSharper.OAuth, the authorization process is handled by a value of type <code>OAuth2.Provider</code>. Let's create a module just below the <code>EndPoint</code> to contain it:</p>
<pre><code>module Authentication =
    open System.IO
    open WebSharper.OAuth

    /// The OAuth2 authorization provider for GitHub.
    let Provider =
</code></pre>
<p>The provider is created using the static method <code>OAuth2.Provider.Setup</code>. It takes three mandatory arguments:</p>
<ul>
<li><p><code>service</code> gives information about the service provider you want to connect to: the standard URLs to which requests are made throughout the process, and the credentials of your application with this service.<br />
WebSharper.OAuth knows these standard URLs for a few common services, and Github is one of those, so you just need to provide your app's credentials: <code>OAuth2.ServiceSettings.Github(&quot;APP_ID&quot;, &quot;APP_SECRET&quot;)</code>.<br />
To obtain these credentials, you need to register your application with Github. At <a href="https://github.com/settings/developers">this page</a>, click &quot;New OAuth App&quot;. You can enter whatever you want as Application name, Homepage URL and Application description. Authorization callback URL, however, must correspond to your redirect endpoint. For our local testing, this will be something like <code>http://localhost:56385/oauth-github</code> (check the actual port in your URL bar!), but once you deploy it to a live server, you will need to change the base URL accordingly.</p>
</li>
<li><p><code>redirectEndpointAction</code> is the sitelet endpoint value for the redirect endpoint: <code>EndPoint.OAuthGitHub</code>.</p>
</li>
<li><p><code>redirectEndpoint</code> creates your actual response when the user is redirected to this redirect endpoint. It is similar to the function passed to <code>Application.MultiPage</code>, except instead of receiving an endpoint value, you receive the user's response to the authorization prompt.</p>
<ul>
<li><p>If they said yes, then this response is <code>OAuth2.Success token</code>. We can use this token to retrieve the username, log in the user, and redirect them to the protected page they were requesting.</p>
</li>
<li><p>If they said no, then we simply redirect them to the home page.</p>
</li>
</ul>
</li>
</ul>
<pre><code>    /// The OAuth2 authorization provider for GitHub.
    let Provider =
        OAuth2.Provider.Setup(
            service = OAuth2.ServiceSettings.Github(&quot;APP_ID&quot;, &quot;APP_SECRET&quot;),
            redirectEndpointAction = EndPoint.OAuthGitHub,
            redirectEndpoint = (fun ctx response -&gt;
                async {
                    match response with
                    | OAuth2.Success token -&gt;
                        let! userData = getUserData token
                        // All good! The user is authenticated.
                        do! ctx.UserSession.LoginUser(userData.login)
                        return! Content.RedirectTemporary EndPoint.About
                    | _ -&gt;
                        // This is &quot;normal&quot; failure: the user simply rejected the authorization.
                        do! ctx.UserSession.Logout()
                        return! Content.RedirectTemporary EndPoint.Home
                }
            )
        )
</code></pre>
<p>I won't go over all the optional arguments, but one of them is particularly useful: <code>defaultScope</code>. Many providers require that you provide a <em>scope</em> for authentication requests, indicating what API data the user will give your application access to. <code>defaultScope</code> defines the scope that will be used for all authentication requests, unless overridden in <code>GetAuthorizationRequestUrl</code> (see below).</p>
<p>Now, we haven't yet implemented <code>getUserData</code>. This function needs to request Github's API using the token and parse the response for the username.</p>
<p>Requesting the service's API is done using a standard <code>System.Net.HttpWebRequest</code>, to which we add the necessary authorization headers using <code>token.AuthorizeRequest</code>.</p>
<p>Github user information is retrieved from <code>https://api.github.com/user</code>. This endpoint returns <a href="https://developer.github.com/v3/users/#get-the-authenticated-user">a JSON object containing a lot of fields</a>. Right now we only care about one: <code>login</code>. We can create a record with just this field and use <code>WebSharper.Json</code> to parse the response.</p>
<pre><code>    type GithubUserData = { login: string }

    /// Get basic user data from GitHub.
    let getUserData (token: OAuth2.AuthenticationToken) =
        async {
            let req =
                System.Net.HttpWebRequest.CreateHttp(&quot;https://api.github.com/user&quot;,
                    KeepAlive = false,
                    UserAgent = &quot;WebSharper OAuthExample&quot;
                )
            token.AuthorizeRequest(req)
            let! response = req.AsyncGetResponse()
            use reader = new StreamReader(response.GetResponseStream())
            let! jsonData = reader.ReadToEndAsync() |&gt; Async.AwaitTask
            return WebSharper.Json.Deserialize&lt;GithubUserData&gt; jsonData
        }
</code></pre>
<p>All right, our provider is ready! Time to use it in the application proper.</p>
<p>First, we need to add the mini-sitelet comprising the redirect endpoint to our main sitelet. It is available as the <code>RedirectEndpointSitelet</code> property.</p>
<pre><code>    [&lt;Website&gt;]
    let Main =
        Authentication.Provider.RedirectEndpointSitelet
        &lt;|&gt;
        Application.MultiPage (fun ctx endpoint -&gt;
            match endpoint with
            | EndPoint.Home -&gt; HomePage ctx
            | EndPoint.About -&gt; AboutPage ctx
            | EndPoint.OAuthGitHub -&gt;
                // This endpoint is already handled by RedirectEndpointSitelet above,
                // so we should never encounter it here.
                Content.ServerError
        )
</code></pre>
<p>Then, we need to handle the user authentication in <code>AboutPage</code>. We will first check the logged in user (with <code>ctx.UserSession.GetLoggedInUser()</code>). If there is one, then we show the normal About page. Otherwise, we provide a link to log in with Github. The full URL for this link can be created by the provider's <code>GetAuthorizationRequestUrl</code> method.</p>
<pre><code>    let AboutPage (ctx: Context&lt;EndPoint&gt;) = async {
        let! loggedIn = ctx.UserSession.GetLoggedInUser()
        match loggedIn with
        | Some username -&gt;
            return! Templating.Main ctx EndPoint.About &quot;About&quot; [
                h1 [] [text (&quot;Welcome &quot; + username)]
                p [] [text &quot;This is a template WebSharper client-server application.&quot;]
            ]
        | None -&gt;
            let loginUrl = Authentication.Provider.GetAuthorizationRequestUrl(ctx)
            return! Templating.Main ctx EndPoint.About &quot;About&quot; [
                h1 [] [text &quot;Not logged in!&quot;]
                p [] [
                    text &quot;Sorry, you need to be logged in to access this page. &quot;
                    a [attr.href loginUrl] [text &quot;Click here&quot;]
                    text &quot; to log in.&quot;
                ]
            ]
    }
</code></pre>
<p>And voilà! We have added Github authentication support to our application. Now, when a user clicks About, they are prompted to log in using Github:</p>
<p><img src="https://imgur.com/bux26F1l.png" alt="Login prompt" /></p>
<p>and when they click the link and authorize your application with Github, they will be logged in and see that you have retrieved their username:</p>
<p><img src="https://imgur.com/jl6I4Mtl.png" alt="Logged in About page" /></p>
<p>That's all folks!</p>
</div></div>
            </div>
        </section>
        <section class="py-20 2xl:py-40">
            <div class="container mx-auto px-4">
                <div class="flex flex-wrap -mx-4 pb-6 lg:pb-20 border-b border-gray-100">
                    <div class="w-full lg:w-3/5 px-4">
                        <div class="flex flex-wrap -mx-4">
                            <div class="w-1/2 lg:w-1/3 px-4 mb-12">
                                <h3 class="mb-8 lg:mb-14 text-xl font-bold font-heading">Zospace</h3>
                                <ul class="text-lg">
                                    <li class="mb-5"><a class="hover:underline" href="#">Hello</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Story</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Pricing</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Applications</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Stats</a></li>
                                    <li><a class="hover:underline" href="#">Blog</a></li>
                                </ul>
                            </div>
                            <div class="w-1/2 lg:w-1/3 px-4 mb-12">
                                <h3 class="mb-8 lg:mb-14 text-xl font-bold font-heading">Products</h3>
                                <ul class="text-lg">
                                    <li class="mb-5"><a class="hover:underline" href="#">Newsletter</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Features</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">How it works</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">FAQ&apos;s</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Portfolio</a></li>
                                    <li><a class="hover:underline" href="#">Team</a></li>
                                </ul>
                            </div>
                            <div class="w-full lg:w-1/3 px-4 mb-4">
                                <h3 class="mb-8 lg:mb-14 text-xl font-bold font-heading">Your Account</h3>
                                <ul class="text-lg">
                                    <li class="mb-5"><a class="hover:underline" href="#">New account</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Log in</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Testimonials</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Contact</a></li>
                                    <li class="mb-5"><a class="hover:underline" href="#">Privacy Policy</a></li>
                                    <li><a class="hover:underline" href="#">Cookies</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="w-full lg:w-2/5 px-4 order-first lg:order-last mb-16 lg:mb-0">
                        <h3 class="mb-16 text-xl font-bold">Newsletter</h3>
                        <form action="#">
                            <div class="md:max-w-sm mb-8 flex items-center bg-white border border-gray-100 rounded-full">
                                <span class="inline-block pl-6 lg:pl-10">
                                    <svg width="37" height="37" viewbox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="18.5" cy="18.5" r="9.5" fill="#1F40FF" fill-opacity="0.15"></circle><circle cx="18.5" cy="18.5" r="18.5" fill="#1F40FF" fill-opacity="0.06"></circle><circle cx="18.5" cy="18.5" r="2.5" fill="#282C36"></circle></svg>
                                </span>
                                <input class="pl-4 py-4 rounded-full placeholder-gray-900 font-bold" type="email" placeholder="Drop your Email" />
                                <button class="ml-auto px-4 px-8 lg:px-10 py-5 text-white font-bold bg-blue-500 hover:bg-blue-600 rounded-full transition duration-200">Ok</button>
                            </div>
                            <p class="text-gray-300">The brown fox jumps over the lazy dog.</p>
                        </form>
                    </div>
                </div>
                <div class="flex flex-wrap items-center pt-10 mb-8 lg:mb-0">
                    <div class="w-full md:w-1/2 mb-8 md:mb-0">
                        <div class="md:flex items-center">
                            <a class="inline-block text-gray-900 text-xl font-bold" href="#">
                                <img class="h-7" src="/files/logos/zospace-dark-logo.svg" alt="" width="auto" />
                            </a>
                            <span class="hidden md:inline-block mx-8 w-px h-8 bg-gray-50"></span>
                            <p class="hidden lg:block text-sm">
                                <span>&copy; 2021 Shuffle.</span>
                                <span class="text-gray-300">All rights reserved.</span>
                            </p>
                        </div>
                    </div>
                    <div class="w-full md:w-1/2">
                        <div class="md:flex items-center justify-end">
                            <a class="inline-block mr-2" href="#">
                                <img src="/files/logos/facebook.svg" alt="" />
                            </a>
                            <a class="inline-block mr-2" href="#">
                                <img src="/files/logos/instagram.svg" alt="" />
                            </a>
                            <a class="inline-block" href="#">
                                <img src="/files/logos/twitter.svg" alt="" />
                            </a>
                        </div>
                    </div>
                </div>
                <p class="lg:hidden text-sm">
                    <span>&copy; 2021 Shuffle.</span>
                    <span class="text-gray-300">All rights reserved.</span>
                </p>
            </div>
        </section>
        
    </div>
    
    <meta id='websharper-data' name='websharper-data' content='{"$TYPES":[],"$DATA":{"$V":{}}}' />
<script src="../../Scripts/WebSharper.Core.JavaScript/Runtime.js" type="text/javascript" charset="UTF-8"></script><script type="text/javascript">
if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '../../Scripts/';
  IntelliFactory.Runtime.Start();
}
</script>

    <script src="/js/Dynamic.min.js"></script>
</body>
</html>